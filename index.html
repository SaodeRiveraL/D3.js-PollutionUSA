<!DOCTYPE html>
<html lang="en">
<head>
  <title>Pollutants in USA</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script type="text/javascript">

  </script>
  <style>
  .fakeimg {
    height: 200px;
    background: #aaa;
  };
    /* Make the image fully responsive */
    .carousel-inner img {
      width: 100%;
      height: 100%;
    }

    /* References : */
/* On mouse hover, lighten state color */
path:hover {
	fill-opacity: .7;
}

/* Style for Custom Tooltip */
div.tooltip {   
 	position: absolute;           
	text-align: center;           
	width: 60px;                  
	height: 28px;                 
	padding: 2px;             
	font: 12px sans-serif;        
	background: white;   
	border: 0px;      
	border-radius: 8px;           
	pointer-events: none;         
}
        
        
/* Legend Position Style */
.legend {
	position:absolute;
	left:180px;
  font-size: large;
}

   </style>
</head>
<body style="background-color: whitesmoke;background-image: url('./resources/back1.jpg');">
<div class="container-fluid">
  <div class = "row" style="background-color: black;">
    <div class="col-6 col-sm-4" style="background-color: black;color:white;font-size: xx-large;">
       <p style="padding-top: 10px; padding-left: 50px;">Pollution in US 2000-2016</p>
    </div>
    <div class="col-6 col-sm-8" style="background-color: black;color:white;font-size: xx-large;padding: 10px;">
        <a href="index.html"><img src="./resources/home0.ico" alt="Home" style="height: 40px;"></a>
        <a href="#demo1" class="btn btn-dark" data-toggle="collapse">Trends</a>
        <a href="#demo2" class="btn btn-dark" data-toggle="collapse">Animations</a>
        <a href="#demo3" class="btn btn-dark" data-toggle="collapse">HeatMaps</a>
        <a href="info.html"><img src="./resources/info.ico" alt="Home" style="height: 40px;"></a>
        <div id="demo1" class="collapse" style="font-size: large;">
            These graphics show the trends of the pollutants 
            <ul>
                <li><a href="trends1.html" style="color:white;">Pollutants per State</a></li>
                <li><a href="trends2.html" style="color:white;">Pollutants per Year</a></li>
            </ul>
         </div>
         <div id="demo2" class="collapse" style="font-size: large;" > 
            Trends of Pollutants by State
            <ul>
                <li><a href="animation1.html" style="color:white;">Trends by State</a></li>
            </ul>
          </div>
        <div id="demo3" class="collapse" style="font-size: large;">
          Heat Map of US by type of pollutant
          <ul>
            <li><a href="Map01.html" style="color:white;">Trends by State</a></li>
          </ul>
     
        </div>
         
    </div>
  </div>
</div> 

<div class="container" style="margin-top:30px;">
  <div class="row">
    <div class="col-sm-5" style="color:white">
      <h3 style="text-align: center;">Air Pollutants</h3>
      <div class=row >
        <div class="col" style="text-align: center;">
          <label>Year:</label>
          <select id="year" name="year" style="background:rgb(0, 0, 0);color: white;">
            <option value="2000">2000</option>
            <option value="2001">2001</option>
            <option value="2002">2002</option>
            <option value="2003">2003</option>
            <option value="2004">2004</option>
            <option value="2005">2005</option>
            <option value="2006">2006</option>
            <option value="2007">2007</option>
            <option value="2008">2008</option>
            <option value="2009">2009</option>
            <option value="2010">2010</option>
            <option value="2011">2011</option>
            <option value="2012">2012</option>
            <option value="2013">2013</option>
            <option value="2014">2014</option>
            <option value="2015">2015</option>
            <option value="2016">2016</option>
          </select>
          <label>Pollutant:</label>
          <select id="pollutant" name="pollutant" style="background:rgb(0, 0, 0);color:white">
            <option value="O3">Ozone</option>
            <option value="NO2">Nitrogen</option>
            <option value="SO2">Sulfur Dioxide</option>
            <option value="CO2">Carbon Dioxide</option>
          </select>
          <button id="go" type="button"  style="background:black;color: white;" onclick="ReDrawMap()">Go</button>
        </div>

      </div>
      <div id = "MapHome" style="color:white"></div>
        <script type="text/javascript">
        </script>
    </div>
    <div class="col-sm-7">
        <div id="demo" class="carousel slide" data-ride="carousel">

            <!-- Indicators -->
            <ul class="carousel-indicators">
              <li data-target="#demo" data-slide-to="0" class="active"></li>
              <li data-target="#demo" data-slide-to="1"></li>
              <li data-target="#demo" data-slide-to="2"></li>
              <li data-target="#demo" data-slide-to="3"></li>
            </ul>
            
            <!-- The slideshow -->
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="./resources/Poll1.jpg" alt="Fig.1" width="700" height="450">
              </div>
              <div class="carousel-item">
                <img src="./resources/Poll2.jpg" alt="Fig.2" width="700" height="450">
              </div>
              <div class="carousel-item">
                <img src="./resources/Poll3.jpg" alt="Fig.3" width="700" height="450">
              </div>
              <div class="carousel-item">
                <img src="./resources/Poll4.jpg" alt="Fig.4" width="700" height="450">
              </div>

            </div>
            
            <!-- Left and right controls -->
            <a class="carousel-control-prev" href="#demo" data-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </a>
            <a class="carousel-control-next" href="#demo" data-slide="next">
              <span class="carousel-control-next-icon"></span>
            </a>
          </div>
          
    </div>
  </div>
  <br>
</div>
<br>
<br>
<div class="container-fluid" style="margin-bottom:0; background-color: black; color:white;">
    <div class="row">
        <div class="col" >
            <div class="row">
                <div class="col" style="padding: 10px;text-align: right;">
                    <img src="./resources/Balam1.png" alt="Balam">
                </div>
                
                <div class="col" style="padding: 10px;">
                    Lilian Sao de Rivera
                    Summer 2020
                </div>
                <div class="col">
                </div>

            </div>
        </div>
        <div class="col" ></div>
        <div class="col" style="padding: 10px;display: inline;" >
            <div class="row">
                <div class="col" style="text-align: right;">
                    <img src="./resources/gw.png" alt="gw" width="60px" height="60px">
                </div>
                <div class="col">
                    Visualization of Complex Data
                    Prof. Nima Zahadat
                </div>            
        </div>
      </div>
    
</div>

</body>
<script type="text/javascript">
        /*  This visualization was made possible by modifying code provided by:
        
        Scott Murray, Choropleth example from "Interactive Data Visualization for the Web" 
        https://github.com/alignedleft/d3-book/blob/master/chapter_12/05_choropleth.html   
                
        Malcolm Maclean, tooltips example tutorial
        http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
        
        Mike Bostock, Pie Chart Legend
        http://bl.ocks.org/mbostock/3888852  */
        
                

  DrawMap();

  function ReDrawMap(){
    d3.select("#Mapsvg").remove();
    d3.select("#Mapdiv").remove();
 
    DrawMap();  
  };

  function DrawMap(xcolor =1 ) {

            //Width and height of map

        var width = 460;
        var height = 350;
        
        // D3 Projection
        var projection = d3.geo.albersUsa()
                           .translate([width/2, height/2])    // translate to center of screen
                           .scale([500]);          // scale things down so see entire US
                
        // Define path generator
        var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
                       .projection(projection);  // tell path generator to use albersUsa projection
        
                
        // Define linear scale for output
        var color = d3.scale.linear()
                      .range(["rgb(200, 51, 73)","rgb(224, 99, 119)","rgb(238, 172, 153)","rgb(201, 76, 76)"]);

        // Define linear scale for output
        var factor = d3.scale.linear()
                      .range([50, 1 , 1 , 1]);

        var legendText = ["O3", "NO2", "SO2", "CO2"];
        
        
        //Create SVG element and append map to the SVG

        var svg = d3.select("#MapHome")
                    .append("svg")
                    .attr("id", "Mapsvg")
                    .attr("width", width)
                    .attr("height", height);
                
        // Append Div for tooltip to SVG
        var div = d3.select("#MapHome")
                    .append("div") 
                    .attr("id","Mapdiv")  
                    .attr("class", "tooltip")               
                    .style("opacity", 0);

 
        var xyear = document.getElementById("year").value;
        var xpollutant = document.getElementById("pollutant").value;

        switch (xpollutant){
          case 'O3':
            xcolor = 0;
            xfactor = 200;
            break;
          case 'NO2' :
            xcolor = 1;
            xfactor = 0.25;
            break;
          case 'SO2':
            xcolor = 2;
            xfactor = 1.05;
            break;
          default:
            xcolor = 3;
            xfactor = 8;

        };

        // Load in my states data!
        d3.csv("./data/TopCities.csv", function(data) {
          
        color.domain([0,1,2,3]); // setting the range of the input data
        
        // Load GeoJSON data and merge with states data
        d3.json("./data/us-states.json", function(json) {
        
        // Loop through each state data value in the .csv file
        for (var i = 0; i < data.length; i++) {
        
            // Grab State Name
            var dataState = data[i].state;
        
            // Grab data value 
            var dataValue = data[i].visited;
        
            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < json.features.length; j++)  {
                var jsonState = json.features[j].properties.NAME;
        
                if (dataState == jsonState) {
        
                // Copy the data value into the JSON
                json.features[j].properties.visited = dataValue; 
        
                // Stop looking through the JSON
                break;
                }
            }
        }
                
        // Bind the data to the SVG and create one path per GeoJSON feature
        svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#fff")
            .style("stroke-width", "1")
            .style("opacity","0.7")
            .style("fill", "white") 
        
                 
        // Map the cities I have lived in!
        d3.csv("./data/TopCities.csv", function(data) {


        data = data.filter(function(d) { return d.year == xyear });
        data = data.filter(function(d) { return d.type == xpollutant });

        
        svg.selectAll("circle")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function(d) {
                return projection([d.Longitude, d.Latitude])[0];
            })
            .attr("cy", function(d) {
                return projection([d.Longitude, d.Latitude])[1];
            })
            .attr("r", function(d) {
                return d.pollutant * xfactor ; 
            })
                .style("fill", color(xcolor))	
                .style("opacity", 0.85)	
        
            // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks" 
            // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
            .on("mouseover", function(d) {      
                div.transition()        
                  .duration(200)      
                  .style("opacity", .9);      
                  div.text(d.City)
                   .style("left", (d3.event.pageX - 200) + "px")     
                   .style("top", (d3.event.pageY - 80) + "px")
                   .style("color","black");    
            })   
        
            // fade out tooltip on mouse out               
            .on("mouseout", function(d) {       
                div.transition()        
                   .duration(500)      
                   .style("opacity", 0);   
            });
        });  
                
            });
        
        });
  }; // End Function DrawMap 


</script>  

</html>
